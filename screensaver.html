<html>
<head>
<meta charset="utf-8">
<title>screen saver</title>
<meta name="theme-color" content="rgb(1,4,9)">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,viewport-fit=contain">
<style>
body
{
    margin: 0px;
    padding: 0px;
    background-color: rgb(230,237,243);
}
div
{
    content-visibility: auto;
}
button
{
    background-color: transparent;
    border-style: none;
    border-width: 0px;
    cursor: pointer;
}
#screen-header
{
    margin: 0px;
    padding: 0px;
    color: rgb(230,237,243);
    background-color: rgb(1,4,9, 0.8);
    position: fixed;
    width: 100%;
    z-index: 900;
    display: flex;
    flex-direction: row;
    justify-content: start;
    align-items: center;
    transition: margin-top 500ms;
}
#screen-header a
{
    color: rgb(230, 237, 243);
}
#screen-header .segment
{
    position: relative;
    display: flex;
    flex-direction: row;
    justify-content: start;
    align-items: center;
    padding: 0.75rem 1.00rem;
    overflow-x: hidden;
    transform: skewX(150deg);
    text-decoration: none !important;
    min-width: 2.25rem;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-weight: 400;
    font-size: 0.75rem;
    line-height: 100%;
    white-space: nowrap;
}
#screen-header .segment:first-child
{
    padding-left: 1.75rem;
    margin-left: -0.75rem;
}
#screen-header .segment + .segment
{
    margin-left: 0rem;
    border-left-style: solid;
    border-left-width: 1px;
    border-left-color: rgb(230,237,243) !important;
}
#screen-header .segment > *
{
    transform: skewX(-150deg);
}
@media (hover: hover)
{
    #screen-header a.segment:hover
    {
        background-color: rgb(70,80,90);
    }
}
#screen-body
{
    position: fixed;
    top: 0px;
    right: 0px;
    bottom: 0px;
    left: 0px;
    z-index: 10;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
#screen-body .canvas
{
    position: fixed;
    top: 0px;
    right: 0px;
    bottom: 0px;
    left: 0px;
    z-index: -100;
    will-change: mix-blend-mode, background-color, background-image, background-position, background-size;
}
#screen-body.difference-mix .canvas
{
    mix-blend-mode: difference;
}
#screen-body.exclusion-mix .canvas
{
    mix-blend-mode: exclusion;
}
#screen-body button
{
    background-color: rgba(1,4, 9, 0.6);
    border-radius: 1.5rem;
    padding: 1.5rem;
    transition: opacity 1000ms;
}
#screen-body button svg
{
    width: 8rem;
    height: 8rem;
    color: rgba(230, 237, 243, 0.7);
    fill: rgba(230, 237, 243, 0.7);
}
@media (hover: hover)
{
    #screen-body button:hover
    {
        background-color: rgba(1,4, 9, 0.8);
    }
    #screen-body button:hover svg
    {
        color: rgba(230, 237, 243, 0.9);
        fill: rgba(230, 237, 243, 0.9);
    }
}
#screen-body .option-panel
{
    position: absolute;
    top: 2.5rem;
    left: 0.5rem;
    width: 33%;
    min-width: 240px;
    max-width: 360px;
    color: rgb(230, 237, 243);
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: start;
    align-items: stretch;
    cursor: pointer;
    transition: opacity 1000ms;
    font-family: Courier;
    font-size: 0.75rem;
}
#screen-body .option-panel label
{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    padding: 0.125rem 0.5rem;
    margin-bottom: 0.125rem;
    margin-right: 0.25rem;
    background-color: rgba(1,4, 9, 0.6);
    border-radius: 0.25rem;
    height: 1.5rem;
    flex-grow: 1;
}
#screen-body .option-panel select
{
    color: rgb(230, 237, 243);
    background-color: transparent;
    border: none;
    border-radius: 0.5rem;
    padding: 0.25rem;
    font-family: Courier;
    font-size: 0.75rem;
    text-align: right;
}
#screen-body #fps
{
    position: absolute;
    top: 1rem;
    right: 1rem;
    color: rgb(230, 237, 243);
    background-color: rgba(1,4, 9, 0.6);
    border-radius: 0.5rem;
    padding: 0.5rem 1.0rem;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: opacity 1000ms;
    font-family: Courier;
    font-size: 0.75rem;
    text-align: right;
    white-space: pre;
    will-change: contents;
}
#screen-body #fps:empty
{
    display: none;
}
#screen-body #powered-by
{
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    color: rgb(230, 237, 243);
    background-color: rgba(1,4, 9, 0.6);
    border-radius: 0.5rem;
    padding: 0.5rem 1.0rem;
    display: block;
    cursor: pointer;
    transition: opacity 1000ms;
    font-family: Courier;
    font-size: 0.75rem;
    text-align: left;
}
#screen-body #powered-by .title
{
    display: block;
    margin: 0px;
    padding: 0px;
}
#screen-body #powered-by ul
{
    display: block;
    margin: 0px;
    padding: 0px;
    padding-left: 1.0rem;
}
#screen-body #powered-by ul li
{
    display: block;
    margin: 0px;
    padding: 0px;
}
#screen-body #powered-by ul li a
{
    color: rgba(230, 237, 243, 0.7);
}
@media (hover: hover)
{
    #screen-body #powered-by ul li a:hover
    {
        color: rgb(230, 237, 243);
    }
}
#screen-body .option-panel input
{
    margin: 0.5rem;
    padding: 0px;
}
body.immersive #screen-header
{
    margin-top: -2.5rem;
}
body.immersive:not(.mousemove) #screen-body
{
    cursor: none;
}
body.immersive.mousemove #screen-body
{
    cursor: pointer;
}
body.immersive:not(.mousemove) #screen-body button
{
    opacity: 0;
    cursor: none;
}
body.immersive #screen-body button svg:first-child
{
    display: none;
}
body:not(.immersive) #screen-body button svg:last-child
{
    display: none;
}
body.immersive #screen-body .option-panel
{
    opacity: 0;
    pointer-events: none;
}
body:not(.immersive) #screen-body #fps
{
    display: none;
}
body.immersive #screen-body #powered-by
{
    display: none;
}
</style>
</head>
<body>
<h1 id="screen-header"><a class="segment" href="https://github.com/"><span>GitHub</span></a><a class="segment" href="https://github.com/wraith13"><span>wraith13</span></a><a class="segment" href="https://wraith13.github.io/"><span>wraith13.github.io</span></a><a class="segment" href="https://github.com/wraith13/wraith13.github.io/blob/master/screensaver.html"><span>screen saver</a></div></h1>
<div id="screen-body">
    <button id="play-button">
        <svg width="100%" height="100%" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
            <g transform="matrix(1,0,0,1,-20.52,-0.152764)">
                <path d="M277.128,192.306L277.129,192C277.294,169.198 295.857,150.737 318.698,150.737C326.626,150.737 334.038,152.961 340.345,156.819L893.467,476.149L893.46,476.161C906.034,483.312 914.523,496.833 914.523,512.321C914.523,529.423 904.173,544.126 889.4,550.504L340.335,867.492C339.741,867.855 339.138,868.203 338.526,868.537L336.016,869.985L335.929,869.834C330.678,872.232 324.842,873.568 318.697,873.568C295.755,873.568 277.128,854.942 277.128,832L277.128,192.306Z"/>
            </g>
        </svg>
        <svg width="100%" height="100%" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
            <g transform="matrix(1.17021,0,0,1.125,-75.5745,-64)">
                <path d="M444,291.176L444,732.824C444,752.238 428.847,768 410.183,768L289.817,768C271.153,768 256,752.238 256,732.824L256,291.176C256,271.762 271.153,256 289.817,256L410.183,256C428.847,256 444,271.762 444,291.176ZM748.218,291.176L748.218,732.824C748.218,752.238 733.065,768 714.401,768L594.035,768C575.371,768 560.218,752.238 560.218,732.824L560.218,291.176C560.218,271.762 575.371,256 594.035,256L714.401,256C733.065,256 748.218,271.762 748.218,291.176Z"/>
            </g>
        </svg>
    </button>
    <div class="option-panel">
        <label for="pattern">
            Pattern:
            <select id="pattern">
                <option value="lines">lines</option>
                <option value="spots">spots</option>
                <option value="multi">multi</option>
            </select>
        </label>
        <label for="mode">
            Mode:
            <select id="mode">
                <option value="monochrome">monochrome</option>
                <option value="primary-colors">primary-colors</option>
                <option value="phi-colors">phi-colors</option>
            </select>
        </label>
        <label for="layers">Layers: <select id="layer"></select></label>
        <label for="span">Span: <select id="span"></select></label>
        <label for=""bottom-fps">Bottom FPS: <select id="bottom-fps"></select></label>
        <label for="easing">Easing: <input id="easing" type="checkbox"></label>
        <label for="with-fullscreen">FullScreen: <input id="with-fullscreen" type="checkbox"></label>
        <label for="show-fps">Show FPS: <input id="show-fps" type="checkbox"></label>
    </div>
    <div id="fps"></div>
    <div id="powered-by">
        <span class="title">powered by</span>
        <ul>
            <li><a href="https://github.com/wraith13/evil-commonjs">evil-commonjs</a></li>
            <li><a href="https://github.com/wraith13/evil-timer.js">evil-timer.js</a></li>
            <li><a href="https://github.com/wraith13/flounder.style.js">flounder.style.js</a></li>
            <li><a href="https://github.com/wraith13/phi-colors">phi-colors</a></li>
        </ul>
    </div>
    <div class="canvas"></div>
</div>
<script src="https://wraith13.github.io/evil-commonjs/index.js"></script>
<script>
window.module.sequentialLoad
([
    { path:"https://wraith13.github.io/evil-timer.js/index.js", mapping:["evil-timer.js"] },
    { path:"https://wraith13.github.io/flounder.style.js/index.js", mapping:["flounder.style.js"] },
    { path:"https://wraith13.github.io/phi-colors/library/source/index.js", mapping:["phi-colors"] },
]).then
(
    map =>
    {
        const { FlounderStyle } = require("flounder.style.js");
        const { phiColors } = require("phi-colors");
        const config =
        {
            modeDefault: "phi-colors",
            colors:
            {
                monochrome: [ "black", "white", ],
                //primaryColors: [ "red", "green", "blue", ],
                primaryColors: [ "red", "yellow", "green", "cyan", "blue", "magenta", ],
            },
            patternDefault: "multi",
            layersEnum: [ 1, 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, ],
            layersDefault: 23,
            bottomFpsEnum: [ 1, 1.5, 3, 5, 10, 15, 20, 25, ],
            bottomFpsDefault: 15,
            autoAdjustLayersCoolTime: 1500,
            spanEnum: [ 1000, 3000, 5000, 12000, 30000, 60000, 180000, ],
            spanDefault: 12000,
            intervalSizeMinRate: 0.03,
            intervalSizeMaxRate: 0.6,
        };
        const diagonalSize = Math.sqrt(Math.pow(window.innerWidth, 2) +Math.pow(window.innerHeight, 2));
        const rate = (min, max) => (r) => min + ((max -min) *r);
        const valueToString = (value) => undefined === value ? "undefined": JSON.stringify(value);
        const stringify = (value) =>
        {
            if (null !== value && undefined !== value)
            {
                if (Array.isArray(value))
                {
                    return "[ " +value.map(i => stringify(i)).join(", ") +" ]";
                }
                if ("object" === typeof value)
                {
                    var result = [];
                    Object.keys(value).forEach
                    (
                        key =>
                        {
                            var v = value[key];
                            if (undefined !== v)
                            {
                                result.push(`${key}:${stringify(v)}`);
                            }
                        }
                    )
                    return "{ " +result.join(", ") +" }";
                }
            }
            if ("number" === typeof value)
            {
                return value.toLocaleString("en-US", { maximumFractionDigits: 4, });
            }
            return valueToString(value);
        };
        const makeRandomInteger = (size) => Math.floor(Math.random() *size);
        const randomSelect = (list) => list[makeRandomInteger(list.length)];
        const indexSelect = (list, ix) => list[ix %list.length];
        const makeRandomSpotArguments = (type, intervalSize) =>
        ({
            type,
            layoutAngle: randomSelect([ "regular", "alternative", ]),
            intervalSize,
            depth: 0.0,
            maxPatternSize: randomSelect([ undefined, intervalSize /4, ]),
            reverseRate: randomSelect([ undefined, 0.0, ]),
        });
        const makeRandomTrispotArguments = (intervalSize) =>
            makeRandomSpotArguments("trispot", intervalSize);
        const makeRandomTetraspotArguments = (intervalSize) =>
            makeRandomSpotArguments("tetraspot", intervalSize);
        const makeRandomLineArguments = (type, intervalSize) =>
        ({
            type,
            layoutAngle: Math.random(),
            intervalSize,
            depth: 0.0,
            maxPatternSize: randomSelect([ undefined, intervalSize /(2 +makeRandomInteger(9)), ]),
            reverseRate: randomSelect([ undefined, 0.0, ]),
            anglePerDepth: randomSelect([ undefined, "auto", "-auto", 1,0, -1.0, ]),
        });
        const makeRandomStripeArguments = (intervalSize) =>
            makeRandomLineArguments("stripe", intervalSize);
        const makeRandomDilineArguments = (intervalSize) =>
            makeRandomLineArguments("diline", intervalSize);
        const makeRandomTrilineArguments = (intervalSize) =>
            makeRandomLineArguments("triline", intervalSize);
        const getPatterns = () =>
        {
            switch (document.getElementById("pattern").value)
            {
                case "lines":
                    return [
                        makeRandomStripeArguments,
                        makeRandomDilineArguments,
                        makeRandomTrilineArguments,
                    ];
                case "spots":
                    return [
                        makeRandomTrispotArguments,
                        makeRandomTetraspotArguments,
                    ];
                case "multi":
                default:
                    return [
                        makeRandomStripeArguments,
                        makeRandomDilineArguments,
                        makeRandomTrilineArguments,
                        makeRandomTrispotArguments,
                        makeRandomTetraspotArguments,
                    ];
            }
        };
        const makeRandomArguments = () => randomSelect
            (getPatterns())
            (
                rate
                (
                    diagonalSize *config.intervalSizeMinRate,
                    diagonalSize *config.intervalSizeMaxRate
                )
                (1.0 -Math.pow(Math.random(), 1))
            );
        const screenBody = document.getElementById("screen-body");
        const patternSelect = document.getElementById("pattern");
        patternSelect.value = config.patternDefault;
        const withFullscreen = document.getElementById("with-fullscreen");
        const showFPS = document.getElementById("show-fps");
        const fullscreenEnabled = document.fullscreenEnabled || document.webkitFullscreenEnabled;
        if ( ! fullscreenEnabled)
        {
            withFullscreen.parentElement.style.setProperty("display", "none");
        }
        const phi = 1.618033988749895;
        let startAt = 0;
        let offsetAt = 0;
        let span = config.spanDefault;
        let h = Math.random();
        let hueUnit = 1 / phiColors.phi;
        let defaultLightness = 0.5;
        let hsl =
        {
            h:rate(phiColors.HslHMin, phiColors.HslHMax)(h),
            s:rate(phiColors.HslSMin, phiColors.HslSMax)(0.8),
            l:rate(phiColors.HslLMin, phiColors.HslLMax)(defaultLightness),
        };
        const makeColor = (step, lightness) =>
            phiColors.rgbForStyle
            (
                phiColors.clipRgb
                (
                    phiColors.hslToRgb
                    ({
                        h: rate(phiColors.HslHMin, phiColors.HslHMax)((h +(hueUnit *step)) %1),
                        s: hsl.s,
                        l: rate(phiColors.HslLMin, phiColors.HslLMax)(lightness ?? defaultLightness),
                    })
                )
            );
        document.getElementsByClassName("canvas")[0].style.setProperty("background-color", makeColor(0));
        document.getElementById("mode").value = config.modeDefault;
        const makeSelectOption = (value, text) =>
        {
            const option = document.createElement("option");
            option.value = value;
            option.innerText = text;
            return option;
        };
        const layersSelect = document.getElementById("layer");
        config.layersEnum.forEach
        (
            i => layersSelect.appendChild(makeSelectOption(i, `${i}`))
        );
        layersSelect.value = config.layersDefault;
        spanSelect = document.getElementById("span");
        config.spanEnum.forEach
        (
            i => spanSelect.appendChild(makeSelectOption(i, `${i /1000}s`))
        );
        spanSelect.value = span;
        bottomFpsSelect = document.getElementById("bottom-fps");
        config.bottomFpsEnum.forEach
        (
            i => bottomFpsSelect.appendChild(makeSelectOption(i, `${i}`))
        );
        bottomFpsSelect.value = config.bottomFpsDefault;
        const fpsCalcUnit = 5;
        let frameTimings = [];
        let fpsHistory = [];
        const resetFps = () =>
        {
            frameTimings = [];
            fpsHistory = [];
        };
        const makeFpsText = (fps) =>
            `${fps.toLocaleString("en-US", { useGrouping: false, maximumFractionDigits: 2, minimumFractionDigits: 2, })} fps`;
        let lastChangedLayersAt = 0;
        const getFpsText = (now) =>
        {
            let result = "";
            if (fpsCalcUnit <= frameTimings.length)
            {
                const first = frameTimings.shift();
                const fps = (fpsCalcUnit *1000.0) /(now -first);
                const current =
                {
                    fps,
                    now,
                    text: makeFpsText(fps),
                };
                const expiredAt = now -1000;
                while(0 < fpsHistory.length && fpsHistory[0].now < expiredAt)
                {
                    fpsHistory.shift();
                }
                fpsHistory.push(current);
                let currentMaxFps = current;
                let currentMinFps = current;
                fpsHistory.forEach
                (
                    i =>
                    {
                        if (currentMaxFps.fps < i.fps)
                        {
                            currentMaxFps = i;
                        }
                        if (i.fps < currentMinFps.fps)
                        {
                            currentMinFps = i;
                        }
                    }
                );
                result = currentMaxFps.text +" (max)\n" + current.text + " (now)\n" +currentMinFps.text +" (min)";
                if
                (
                    7 < layers.length &&
                    (lastChangedLayersAt +config.autoAdjustLayersCoolTime) <= now &&
                    currentMaxFps.fps < parseFloat(bottomFpsSelect.value)
                )
                {
                    const newLayersNominated = layers.length *currentMaxFps.fps /config.autoAdjustLayersThresholdFps;
                    const newLayers = Math.max(7, ...config.layersEnum.filter(i => i < newLayersNominated));
                    document.getElementById("layer").value = newLayers.toString();
                    console.log(`fps: ${current.text}, layers: ${layers.length} -> ${newLayers}`);
                    updateLayers(newLayers);
                    lastChangedLayersAt = now;
                    resetFps();
                }
            }
            frameTimings.push(now);
            return result;
        };
        const easingCheckbox = document.getElementById("easing");
        //easingCheckbox.checked = true;
        let easing;
        let layers = [];
        const getStep = (universalStep, layer) => universalStep -(layer.mile +layer.offset);
        const animation = (now) =>
        {
            if (document.body.classList.contains("immersive"))
            {
                const fps = getFpsText(now);
                if (showFPS.checked)
                {
                    document.getElementById("fps").innerText = fps;
                }
                const universalStep = (now -startAt) /span;
                layers.forEach
                (
                    (i, ix) =>
                    {
                        let step = getStep(universalStep, i);
                        if (0 <= step)
                        {
                            if (1.0 <= step || undefined === i.arguments)
                            {
                                i.arguments = Object.assign
                                (
                                    {},
                                    layers[ix -1]?.arguments ?? makeRandomArguments
                                    (
                                        makeColor(1.0),
                                        makeColor(0.0)
                                    )
                                );
                            }
                            while(1.0 <= step)
                            {
                                ++i.mile;
                                step = getStep(universalStep, i);
                            }
                            switch (document.getElementById("mode").value ?? "phi-colors")
                            {
                            case "monochrome":
                                i.arguments.backgroundColor = indexSelect(config.colors.monochrome, i.mile );
                                i.arguments.foregroundColor = indexSelect(config.colors.monochrome, i.mile +1);
                                break;
                            case "primary-colors":
                                i.arguments.backgroundColor = indexSelect(config.colors.primaryColors, ix +i.mile);
                                i.arguments.foregroundColor = indexSelect(config.colors.primaryColors, ix +i.mile +1);
                                break;
                            case "phi-colors":
                                i.arguments.backgroundColor = makeColor(0.0 +i.mile +i.offset, 0.6);//, defaultLightness *(1.0 -(Math.pow(step, 2.0) *0.25)));
                                i.arguments.foregroundColor = makeColor(1.0 +i.mile +i.offset, 0.6);//, rate(defaultLightness, 1.0)(Math.pow(1.0 -step, 2.0)));
                                break;
                            }
                            if (i.mile <= 0 && 0 < i.offset)
                            {
                                i.arguments.backgroundColor = "black";
                            }
                            i.arguments.depth = easing(step);
                            FlounderStyle.setStyle(i.canvas, i.arguments);
                        }
                    }
                );
                window.requestAnimationFrame(animation);
            }
            else
            {
                if (undefined !== layers[0].arguments)
                {
                    offsetAt = now -startAt;
                    document.getElementById("fps").innerText = "";
                }
            }
        };
        const pause = () =>
        {
            document.body.classList.toggle("immersive", false);
            if (document.fullscreenElement || document.webkitFullscreenElement)
            {
                if (document.exitFullscreen)
                {
                    document.exitFullscreen();
                }
                else
                if (document.webkitCancelFullScreen)
                {
                    document.webkitCancelFullScreen();
                }
            }
        };
        class ToggleClassForWhileTimer
        {
            constructor()
            {
                this.timer = undefined;
            }
            start(element, token, span)
            {
                if (undefined !== this.timer)
                {
                    clearTimeout(this.timer);
                }
                element.classList.toggle(token, true);
                this.timer = setTimeout
                (
                    () =>
                    {
                        this.timer = undefined;
                        element.classList.toggle(token, false);
                    },
                    span
                );
            }
        }
        screenBody.addEventListener
        (
            "click",
            event =>
            {
                event.stopPropagation();
                if (event.target === event.currentTarget)
                {
                    pause();
                }
            }
        );
        const mousemoveTimer = new ToggleClassForWhileTimer();
        screenBody.addEventListener
        (
            "mousemove",
            () => mousemoveTimer.start(document.body, "mousemove", 1000)
        )
        const updateLayers = (newLayers) =>
        {
            const oldCanvasList = Array.from(document.getElementsByClassName("canvas"));
            if (oldCanvasList.length < newLayers)
            {
                for (let i = oldCanvasList.length; i < newLayers; ++i)
                {
                    const newCanvas = document.createElement("div");
                    newCanvas.classList.add("canvas");
                    screenBody.appendChild(newCanvas);
                }
            }
            else
            {
                for (let i = newLayers; i < oldCanvasList.length; ++i)
                {
                    screenBody.removeChild(oldCanvasList[i]);
                }
            }
            const canvasList = Array.from(document.getElementsByClassName("canvas"));
            layers = canvasList.map
            (
                (canvas, ix) =>
                ({
                    canvas,
                    mile: layers[ix]?.mile ?? 0,
                    offset: ix /canvasList.length,
                    arguments: layers[ix]?.arguments,
                })
            );
        };
        document.getElementById("play-button").addEventListener
        (
            "click",
            event =>
            {
                if ( ! document.body.classList.contains("immersive"))
                {
                    event.stopPropagation();
                    document.body.classList.toggle("immersive", true);
                    document.body.classList.toggle("mousemove", false);
                    if (fullscreenEnabled && withFullscreen.checked)
                    {
                        if (document.body.requestFullscreen)
                        {
                            document.body.requestFullscreen();
                        }
                        else
                        if (document.body.webkitRequestFullscreen)
                        {
                            document.body.webkitRequestFullscreen();
                        }
                    }
                    const newSpan = parseInt(document.getElementById("span").value);
                    if (span !== newSpan)
                    {
                        offsetAt = offsetAt *(newSpan /span);
                        span = newSpan;
                    }
                    const newLayers = parseInt(document.getElementById("layer").value);
                    updateLayers(newLayers);
                    screenBody.className = "monochrome" === document.getElementById("mode").value ?
                        "exclusion-mix":
                        "difference-mix";
                    easing = easingCheckbox.checked ?
                        (t) => t <= 0.5 ?
                            2 *Math.pow(t, 2):
                            1 -(2 *Math.pow(1 -t, 2)):
                        (t) => t;
                    window.requestAnimationFrame
                    (
                        now =>
                        {
                            startAt = now -offsetAt;
                            lastChangedLayersAt = now;
                            resetFps();
                            animation(now);
                        }
                    );
                }
                else
                {
                    pause();
                }
            }
        );
    }
);
</script>
</body>
</html>